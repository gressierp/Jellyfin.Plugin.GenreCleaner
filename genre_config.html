<div id="GenreCleanerConfigPage" data-role="page" class="page type-interior pluginConfigurationPage" data-require="ApiClient, loading, emby-input, emby-checkbox, emby-button">
    <div data-role="content">
        <div class="content-primary">
            <form id="GenreCleanerConfigForm">
                <div class="config-wide-Section">
                    <h2 class="sectionTitle">Genre Cleaner Settings</h2>
                    
                    <div class="checkboxContainer checkboxContainer-withDescription">
                        <label>
                            <input is="emby-checkbox" type="checkbox" id="chkEnableAutoClean" name="EnableAutoClean" />
                            <span>Enable Automatic Cleaning</span>
                        </label>
                        <div class="fieldDescription">Automatically cleans genres when a new movie or series is added to the library.</div>
                    </div>

                    <div class="inputContainer">
                        <label class="inputLabel" for="txtMappings">Genre Mappings</label>
                        <textarea is="emby-input" id="txtMappings" name="Mappings" rows="10" style="height: 300px; font-family: monospace;"></textarea>
                        <div class="fieldDescription">
                            Enter one mapping per line in the format: <strong>SourceGenre=TargetGenre</strong><br/>
                            Example: <em>Science-Fiction=Sci-Fi</em> or <em>Action & Adventure=Action</em>
                        </div>
                    </div>

                    <div class="infoBanner" style="margin: 2em 0; padding: 1em; background: #333; border-radius: 5px;">
                        <strong>Note:</strong> Changes will lock the Genres field for the item to prevent them from being overwritten during the next metadata provider scan.
                    </div>

                    <div style="display: flex; gap: 1em; align-items: center;">
                        <button is="emby-button" type="submit" class="raised button-submit block">
                            <span>Save Settings</span>
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <script type="text/javascript">
        var GenreCleanerConfig = {
            pluginId: "7a4b2c1d-8e9f-4a3b-b2c1-d8e9f4a3b2c1"
        };

        $('#GenreCleanerConfigPage').on('pageshow', function () {
            loading.show();
            var page = this;
            ApiClient.getPluginConfiguration(GenreCleanerConfig.pluginId).then(function (config) {
                $('#chkEnableAutoClean', page).checked(config.EnableAutoClean || false).checkboxradio('refresh');
                $('#txtMappings', page).val(config.Mappings || '');
                loading.hide();
            });
        });

        $('#GenreCleanerConfigForm').on('submit', function () {
            loading.show();
            var page = $(this).parents('#GenreCleanerConfigPage')[0];
            ApiClient.getPluginConfiguration(GenreCleanerConfig.pluginId).then(function (config) {
                config.EnableAutoClean = $('#chkEnableAutoClean', page).checked();
                config.Mappings = $('#txtMappings', page).val();
                ApiClient.updatePluginConfiguration(GenreCleanerConfig.pluginId, config).then(function (result) {
                    Dashboard.processPluginConfigurationUpdateResult(result);
                });
            });
            return false;
        });
    </script>
</div>
